<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư Tình Tương Tác - Đã Sửa Lỗi</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CÀI ĐẶT CƠ BẢN --- */
        body{background-color:#f7e8ee;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;overflow:hidden;font-family:Arial,sans-serif}
        .container{position:relative;width:300px;height:200px;display:flex;justify-content:center;align-items:center}
        
        /* --- THƯ VÀ PHONG BÌ (Đã tăng Z-Index) --- */
        .envelope{
            position:absolute;width:100%;height:100%;
            z-index: 100; /* TĂNG ĐỘ ƯU TIÊN TUYỆT ĐỐI */
            cursor:pointer;filter:drop-shadow(0 4px 8px rgba(0,0,0,.1));transition:transform .5s ease-in-out
        }
        .body{background-color:#d8cce8;width:100%;height:100%;position:absolute;bottom:0;clip-path:polygon(0 0,100% 0,100% 100%,0 100%);z-index:95} /* Giảm z-index để phong bì luôn trên cùng */
        .flap{width:0;height:0;border-style:solid;border-width:150px 150px 0 150px;border-color:#e4d8f1 transparent transparent transparent;position:absolute;top:-100px;left:0;transform-origin:bottom;transition:transform .5s ease-in-out;z-index:105} /* Flap phải cao hơn envelope body */
        .heart{position:absolute;width:30px;height:30px;background-color:#8c5d9a;transform:rotate(-45deg);top:5px;left:calc(50% - 15px);z-index:110}
        
        /* Lá thư */
        .letter{
            position:absolute;width:80%;max-width:400px;background-color:#fff;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,.2);
            transform:translateY(150%) scale(.5);opacity:0; /* Trạng thái ban đầu */
            transition:all .7s ease-in-out;z-index:50; /* Z-index thấp hơn phong bì */
            font-family:'Dancing Script',cursive;line-height:1.5;color:#333;text-align:center
        }
        .letter .content{font-size:18px}.letter .signature-name{font-size:20px;margin-top:10px;font-weight:700}
        .envelope.open .flap{transform:rotateX(180deg)}
        .envelope.open + .letter{transform:translateY(-100px) scale(1);opacity:1;}
        
        /* --- HIỆU ỨNG TRÁI TIM BAY --- */
        .floating-hearts{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none; z-index: 1;} /* Đảm bảo z-index thấp */
        .floating-hearts span{position:absolute;color:#f095b3;font-size:35px;opacity:.5;animation:floatUp 15s infinite ease-in}
        .floating-hearts span:nth-child(2){left:30%;animation-delay:3s;color:#d8cce8;}
        .floating-hearts span:nth-child(4){left:70%;animation-delay:9s;color:#d8cce8;}
        @keyframes floatUp{0%{transform:translateY(100vh) scale(.5);opacity:.5}50%{opacity:1}100%{transform:translateY(-10vh) scale(1.5);opacity:0}}
        
        /* --- IPHONE STYLING --- */
        .iphone-container{position:absolute;opacity:0;transition:opacity 1s ease-in-out,transform 1s ease-in-out;transform:translateY(100px);z-index:200} /* Rất cao để hiện sau cùng */
        .iphone-container.visible{opacity:1;transform:translateY(0)}
        .iphone{width:250px;height:450px;background-color:#333;border-radius:35px;padding:15px;box-shadow:0 10px 30px rgba(0,0,0,.4);position:relative;border-top:8px solid #333}
        .iphone::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:60px;height:10px;background-color:#222;border-bottom-left-radius:10px;border-bottom-right-radius:10px}
        .screen{background-color:#000;width:100%;height:100%;border-radius:15px;position:relative;overflow:hidden;transition:background-color .5s}
        .screen.active{background-color:#fff}
        
        /* --- THÔNG BÁO MESSENGER --- */
        .notification-bar{position:absolute;top:-100px;left:50%;transform:translateX(-50%);width:90%;padding:8px 10px;background-color:rgba(255,255,255,.95);border-radius:12px;display:flex;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.2);cursor:pointer;z-index:250;transition:top .3s ease-out,opacity .3s;opacity:0}
        .notification-bar.show{top:20px;opacity:1}
        .app-icon{width:30px;height:30px;margin-right:10px;display:flex;justify-content:center;align-items:center}
        .messenger-icon{width:25px;height:25px;background:radial-gradient(circle at top right,#38c8ff,#0084ff);border-radius:50%;position:relative}
        .notification-content{color:#333;text-align:left;flex-grow:1}
        .sender-name{font-weight:700;margin:0;font-size:14px}
        .message-preview{margin:0;font-size:12px;color:#555}
        
        /* --- CỬA SỔ MESSENGER --- */
        .messenger-window{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;transform:translateY(100%);transition:transform .4s ease-out; z-index: 280;}
        .messenger-window.open{transform:translateY(0)}
        .chat-header{padding:10px;background-color:#0084ff;color:#fff;font-size:16px;font-weight:700;display:flex;align-items:center}
        .back-btn{margin-right:15px;cursor:pointer;font-size:20px}
        .chat-body{padding:15px;height:calc(100% - 45px);overflow-y:auto}
        .video-message{background-color:#0084ff;color:#fff;padding:10px 15px;border-radius:15px 15px 15px 0;display:inline-flex;align-items:center;max-width:70%;margin-top:10px;cursor:pointer;text-align:center}
        .video-message p{margin:0;font-size:14px}
        .play-icon{margin-left:10px;font-size:16px}
        
        /* --- VIDEO PLAYER OVERLAY --- */
        .video-player{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:300}
        .video-player.playing{display:flex}
        #myVideo{
            width: 90%;
            max-height: 90%;
            border-radius: 10px;
            object-fit: contain; 
        }
        .close-video-btn{position:absolute;top:10px;right:10px;background:none;border:2px solid #fff;color:#fff;border-radius:50%;width:30px;height:30px;cursor:pointer;font-size:16px}
    </style>
</head>
<body>

    <div class="container">
        <div class="envelope" id="envelope">
            <div class="flap"></div>
            <div class="body"></div>
            <div class="heart"></div>
        </div>

        <div class="letter" id="letter">
            <p class="greeting">Dear My Dear!</p>
            <p class="content">Thiên thần của tôi, em giúp anh nhận ra ánh mắt nhìn một gam màu... dù ấm áp nhưng cũng đầy câm lặng. Em không chỉ là người yêu, mà còn là người bạn. Là chiếc bến bình yên mỗi khi anh mệt mỏi. Cứ những lúc anh chưa đủ dũng khí để chia sẻ hết nỗi lòng, những tin nhắn em hãy lắng nghe, anh dành cho em là chất lỏng mang ngày càng lớn theo thời gian. Một khoảnh khắc bình dị, em đã thắp sáng tim anh. Em đang trông đợi điều tốt đẹp nhất mỗi anh. Cảm ơn em của anh, yêu anh những giây phút em im lặng, mà hãnh diện khi luôn được em nhìn nhận trong cuộc đời anh – như những nhành cây không dễ thay đổi. Cảm ơn em đã đến, mà mang em ở lại, cùng anh viết nên những ngày mới.</p>
            <p class="signature">Mãi yêu em!</p>
            <p class="signature-name">Kỳ Ân</p>
        </div>
    </div>

    <div class="floating-hearts">
        <span>&#10084;</span><span>&#10084;</span><span>&#10084;</span><span>&#10084;</span><span>&#10084;</span>
    </div>

    <div class="iphone-container">
        <div class="iphone">
            <div class="screen">
                <div class="notification-bar" id="notificationBar">
                    <div class="app-icon"><div class="messenger-icon"></div></div>
                    <div class="notification-content">
                        <p class="sender-name">A1-K62</p>
                        <p class="message-preview">Đã gửi một video...</p>
                    </div>
                </div>

                <div class="messenger-window" id="messengerWindow">
                    <div class="chat-header">
                        <span class="back-btn">&lt;</span>
                        <span class="header-name">A1-K62</span>
                    </div>
                    <div class="chat-body">
                        <div class="video-message" id="videoMessage">
                            <p>Nhấp để xem video</p>
                            <span class="play-icon">&#9654;</span>
                        </div>
                    </div>
                    <div class="video-player" id="videoPlayer">
                        <video id="myVideo" controls>
                            <source src="./ogUCSsuRFQpEERTBEoUgddDqFHfOAB7zBIkJeo.mp4" type="video/mp4"> 
                            Trình duyệt của bạn không hỗ trợ thẻ video.
                        </video>
                        <button class="close-video-btn" id="closeVideoBtn">X</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const envelope = document.getElementById('envelope');
            const letter = document.getElementById('letter');
            const iphoneContainer = document.querySelector('.iphone-container');
            const screen = document.querySelector('.screen');
            const notificationBar = document.getElementById('notificationBar');
            const messengerWindow = document.getElementById('messengerWindow');
            const videoMessage = document.getElementById('videoMessage');
            const videoPlayer = document.getElementById('videoPlayer');
            const myVideo = document.getElementById('myVideo');
            const closeVideoBtn = document.getElementById('closeVideoBtn');
            const backBtn = document.querySelector('.back-btn');

            // --- Hàm thiết lập lại trạng thái ẩn (quan trọng) ---
            function resetIphoneState() {
                // Đảm bảo iPhone và các trạng thái liên quan bị ẩn
                iphoneContainer.classList.remove('visible');
                screen.classList.remove('active');
                notificationBar.classList.remove('show');
                messengerWindow.classList.remove('open');
                videoPlayer.classList.remove('playing');
                myVideo.pause();
                myVideo.currentTime = 0;
            }

            // --- BƯỚC 1: Mở/Đóng Thư (Đã sửa lỗi) ---
            envelope.addEventListener('click', function(e) {
                // Ngăn chặn sự kiện click lan truyền, đôi khi cần thiết trên một số môi trường
                e.stopPropagation(); 
                
                if (!envelope.classList.contains('open')) {
                    // Mở thư (Click 1): 
                    // 1. Đảm bảo iPhone ẩn
                    resetIphoneState(); 
                    // 2. Mở phong bì và hiện thư
                    envelope.classList.add('open');
                    letter.style.opacity = 1;
                    letter.style.transform = 'translateY(-100px) scale(1)';

                } else {
                    // Đóng thư & Hiện iPhone (Click 2):
                    // 1. Đóng phong bì
                    envelope.classList.remove('open');
                    
                    // 2. Ẩn lá thư
                    letter.style.opacity = 0;
                    letter.style.transform = 'translateY(150%) scale(0.5)';

                    // 3. Hiện iPhone sau khi thư đóng mượt mà
                    setTimeout(showIphone, 700); 
                }
            });

            // --- BƯỚC 2: Hiện iPhone và Thông báo ---
            function showIphone() {
                iphoneContainer.classList.add('visible');
                
                setTimeout(() => {
                    screen.classList.add('active'); // Bật màn hình
                    setTimeout(() => {
                        notificationBar.classList.add('show'); // Hiển thị thông báo
                    }, 500);
                }, 500);
            }
            
            // --- BƯỚC 3 & 4: Logic iPhone/Messenger/Video (Không thay đổi) ---
            notificationBar.addEventListener('click', function() {
                notificationBar.classList.remove('show'); 
                messengerWindow.classList.add('open');
            });

            videoMessage.addEventListener('click', function() {
                videoPlayer.classList.add('playing');
                myVideo.play();
            });

            closeVideoBtn.addEventListener('click', function() {
                myVideo.pause();
                myVideo.currentTime = 0;
                videoPlayer.classList.remove('playing');
            });
            
            backBtn.addEventListener('click', function() {
                messengerWindow.classList.remove('open');
            });
        });
    </script>
</body>
</html>
